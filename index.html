<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quest XP Tracker</title>

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --line:rgba(0,0,0,0.08);
  --primary:#7c3aed;
  --primary2:#2563eb;
  --accent:#22c55e;
  --danger:#ef4444;
}

[data-theme="dark"]{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --line:rgba(255,255,255,0.1);
}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}

.topbar{
  position:sticky;
  top:0;
  z-index:999;
  padding:16px;
  background:linear-gradient(90deg,var(--primary),var(--primary2));
  color:white;
}

.topbar h1{
  margin:0;
  font-size:20px;
}

.stats{
  margin-top:10px;
}

.levelBar{
  height:12px;
  background:rgba(255,255,255,0.25);
  border-radius:999px;
  overflow:hidden;
  margin-top:6px;
}

.levelFill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#34d399,#22c55e);
  transition:width .2s ease;
}

.page{
  padding:16px;
  max-width:900px;
  margin:auto;
}

.category{
  background:var(--card);
  border-radius:12px;
  padding:14px;
  margin-bottom:14px;
  border:1px solid var(--line);
}

.category h3{
  margin:0 0 10px 0;
}

.task, .reward{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid var(--line);
}

.task:last-child, .reward:last-child{
  border-bottom:none;
}

.left{
  display:flex;
  gap:10px;
  flex:1;
}

.task input{
  width:20px;
  height:20px;
  accent-color:var(--accent);
}

.labelText{
  white-space:normal;
  word-break:break-word;
}

.labelText.done{
  text-decoration:line-through;
  opacity:.5;
}

button{
  background:var(--accent);
  border:none;
  padding:8px 12px;
  border-radius:8px;
  color:white;
  font-weight:700;
  cursor:pointer;
}

button.delete{
  background:var(--danger);
}

.reward.unlocked{
  box-shadow:0 0 0 2px rgba(34,197,94,.3),0 0 20px rgba(34,197,94,.4);
}

.form{
  margin-top:20px;
}

input{
  padding:8px;
  margin:4px 0;
  width:100%;
  border-radius:8px;
  border:1px solid var(--line);
  background:transparent;
  color:var(--text);
}
</style>
</head>

<body>

<div class="topbar">
  <h1>Quest XP Tracker</h1>
  <div class="stats">
    Spendable XP: <strong id="spendable">0</strong><br>
    Earned XP: <strong id="earned">0</strong><br>
    Level: <strong id="level">1</strong>
    <div class="levelBar">
      <div class="levelFill" id="levelFill"></div>
    </div>
  </div>
  <button onclick="toggleTheme()">Toggle Dark Mode</button>
</div>

<div class="page">
  <div class="category">
    <h3>Tasks</h3>
    <div id="taskList"></div>
  </div>

  <div class="category">
    <h3>Rewards</h3>
    <div id="rewardList"></div>
  </div>

  <div class="category form">
    <h3>Add Task</h3>
    <input id="taskName" placeholder="Task name">
    <input id="taskPoints" type="number" placeholder="Points">
    <button onclick="addTask()">Add Task</button>
  </div>

  <div class="category form">
    <h3>Add Reward</h3>
    <input id="rewardName" placeholder="Reward name">
    <input id="rewardCost" type="number" placeholder="Cost">
    <button onclick="addReward()">Add Reward</button>
  </div>
</div>

<script>
// UUID fallback
function uuid(){
  if(window.crypto && crypto.randomUUID) return crypto.randomUUID();
  return 'id-'+Date.now().toString(36)+'-'+Math.random().toString(36).slice(2);
}

// Storage helpers
function get(key, fallback){
  try{
    return JSON.parse(localStorage.getItem(key)) ?? fallback;
  }catch{
    return fallback;
  }
}
function set(key,value){
  localStorage.setItem(key,JSON.stringify(value));
}

let spendableXp = get("spendableXp",0);
let earnedXp = get("earnedXp",0);
let tasks = get("tasks",[]);
let rewards = get("rewards",[]);
let done = get("done",{}); // taskId:true

function xpToNext(level){
  return 50 + (level-1)*25;
}

function computeLevel(xp){
  let lvl=1;
  let remaining=xp;
  while(true){
    let need=xpToNext(lvl);
    if(remaining<need) return {lvl,progress:remaining,need};
    remaining-=need;
    lvl++;
  }
}

function updateHeader(){
  document.getElementById("spendable").textContent=spendableXp;
  document.getElementById("earned").textContent=earnedXp;
  const lvl=computeLevel(earnedXp);
  document.getElementById("level").textContent=lvl.lvl;
  document.getElementById("levelFill").style.width=(lvl.progress/lvl.need*100)+"%";
  set("spendableXp",spendableXp);
  set("earnedXp",earnedXp);
}

function renderTasks(){
  const list=document.getElementById("taskList");
  list.innerHTML="";
  tasks.forEach(task=>{
    const row=document.createElement("div");
    row.className="task";

    const left=document.createElement("div");
    left.className="left";

    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.checked=!!done[task.id];

    const label=document.createElement("div");
    label.className="labelText";
    label.textContent=`${task.name} (${task.points} XP)`;
    if(cb.checked) label.classList.add("done");

    cb.onchange=()=>{
      if(cb.checked){
        spendableXp+=task.points;
        earnedXp+=task.points;
        done[task.id]=true;
      }else{
        spendableXp-=task.points;
        earnedXp-=task.points;
        delete done[task.id];
      }
      set("done",done);
      updateHeader();
      renderRewards();
      renderTasks();
    };

    left.appendChild(cb);
    left.appendChild(label);

    const del=document.createElement("button");
    del.textContent="Delete";
    del.className="delete";
    del.onclick=()=>{
      delete done[task.id];
      tasks=tasks.filter(t=>t.id!==task.id);
      set("tasks",tasks);
      set("done",done);
      renderTasks();
    };

    row.appendChild(left);
    row.appendChild(del);
    list.appendChild(row);
  });
}

function renderRewards(){
  const list=document.getElementById("rewardList");
  list.innerHTML="";
  rewards.forEach(r=>{
    const row=document.createElement("div");
    row.className="reward";
    if(spendableXp>=r.cost) row.classList.add("unlocked");

    const left=document.createElement("div");
    left.className="left";

    const buy=document.createElement("button");
    buy.textContent="Buy";
    buy.onclick=()=>{
      if(spendableXp>=r.cost){
        spendableXp-=r.cost;
        updateHeader();
        renderRewards();
        alert("Reward claimed!");
      }
    };

    const text=document.createElement("div");
    text.className="labelText";
    text.textContent=`${r.name} (Cost ${r.cost} XP)`;

    left.appendChild(buy);
    left.appendChild(text);

    const del=document.createElement("button");
    del.textContent="Delete";
    del.className="delete";
    del.onclick=()=>{
      rewards=rewards.filter(x=>x.id!==r.id);
      set("rewards",rewards);
      renderRewards();
    };

    row.appendChild(left);
    row.appendChild(del);
    list.appendChild(row);
  });
}

function addTask(){
  const name=document.getElementById("taskName").value.trim();
  const pts=parseInt(document.getElementById("taskPoints").value);
  if(!name||isNaN(pts)) return;
  tasks.push({id:uuid(),name,points:pts});
  set("tasks",tasks);
  document.getElementById("taskName").value="";
  document.getElementById("taskPoints").value="";
  renderTasks();
}

function addReward(){
  const name=document.getElementById("rewardName").value.trim();
  const cost=parseInt(document.getElementById("rewardCost").value);
  if(!name||isNaN(cost)) return;
  rewards.push({id:uuid(),name,cost});
  set("rewards",rewards);
  document.getElementById("rewardName").value="";
  document.getElementById("rewardCost").value="";
  renderRewards();
}

function toggleTheme(){
  const current=document.documentElement.getAttribute("data-theme");
  document.documentElement.setAttribute("data-theme",current==="dark"?"light":"dark");
}

updateHeader();
renderTasks();
renderRewards();
</script>

</body>
</html>
