<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Jobs</title>
<style>
  :root{ --bg:#f3f4f6; --card:#fff; --text:#111827; --muted:#6b7280; --line:rgba(0,0,0,0.10); --accent:#22c55e; --danger:#ef4444; }
  [data-theme="dark"]{ --bg:#0b1220; --card:#111a2e; --text:#e5e7eb; --muted:#9ca3af; --line:rgba(255,255,255,0.12); }
  body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text); }
  .top{ position:sticky; top:0; z-index:9; padding:14px; background:linear-gradient(90deg,#7c3aed,#2563eb); color:#fff; }
  .wrap{ max-width:1100px; margin:0 auto; padding:16px; }
  .card{ background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px; margin-bottom:14px; }
  a{ color:#fff; font-weight:900; text-decoration:none; }
  input, select{ width:100%; padding:12px; border-radius:12px; border:1px solid var(--line); background:transparent; color:var(--text); outline:none; }
  button{ padding:10px 12px; border:none; border-radius:12px; cursor:pointer; font-weight:900; color:#fff; background:linear-gradient(90deg,var(--accent),#16a34a); }
  .xBtn{ width:34px; height:34px; border-radius:999px; padding:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(90deg,var(--danger),#dc2626); font-size:18px; }
  .grid{ display:grid; grid-template-columns: 2fr 2fr 1fr 1fr 1fr; gap:10px; }
  .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
  .tableWrap{ width:100%; overflow:auto; border:1px solid var(--line); border-radius:12px; }
  table{ width:100%; border-collapse: collapse; min-width: 900px; }
  th, td{ border-bottom:1px solid var(--line); padding:10px; text-align:left; vertical-align:top; }
  th{ color:var(--muted); font-size:12px; }
  .muted{ color:var(--muted); font-size:12px; }
</style>
</head>
<body>
  <div class="top">
    <div style="max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:10px;">
      <div style="font-weight:900;">Jobs</div>
      <a href="./index.html">← Back</a>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <h3 style="margin:0 0 10px 0;">Add application</h3>
      <div class="grid">
        <input id="company" placeholder="Company" />
        <input id="role" placeholder="Role / position" />
        <input id="date" type="date" />
        <input id="time" type="time" />
        <select id="priority">
          <option value="1">Priority 1 (low)</option>
          <option value="2">Priority 2</option>
          <option value="3" selected>Priority 3</option>
          <option value="4">Priority 4</option>
          <option value="5">Priority 5 (high)</option>
        </select>
      </div>
      <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
        <button onclick="Jobs.add()">Add</button>
        <div class="muted">Tip: date/time uses your phone time.</div>
      </div>
    </div>

    <div class="card">
      <div class="grid2" style="align-items:end;">
        <div>
          <h3 style="margin:0 0 10px 0;">Applications</h3>
          <div class="muted">Sort by time or priority.</div>
        </div>
        <div>
          <label class="muted">Sort</label>
          <select id="sort" onchange="Jobs.render()">
            <option value="time_desc" selected>Time (newest first)</option>
            <option value="time_asc">Time (oldest first)</option>
            <option value="prio_desc">Priority (high → low)</option>
            <option value="prio_asc">Priority (low → high)</option>
          </select>
        </div>
      </div>

      <div class="tableWrap" style="margin-top:10px;">
        <table id="jobsTable"></table>
      </div>
    </div>
  </div>

<script>
  // Theme sync
  const theme = localStorage.getItem("theme");
  if (theme){
    try{ document.documentElement.setAttribute("data-theme", JSON.parse(theme)); } catch {}
  }

  const LS = {
    get(key, fallback){
      try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
      catch { return fallback; }
    },
    set(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
  };

  function uuid(){
    if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
    return 'id-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2);
  }

  function localNowISO(){
    const d = new Date();
    const yr = d.getFullYear();
    const mo = String(d.getMonth()+1).padStart(2,'0');
    const da = String(d.getDate()).padStart(2,'0');
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    return { date:`${yr}-${mo}-${da}`, time:`${hh}:${mm}` };
  }

  const Jobs = (() => {
    let rows = LS.get("jobs_v1", []);

    function persist(){ LS.set("jobs_v1", rows); }

    function add(){
      const company = document.getElementById("company").value.trim();
      const role = document.getElementById("role").value.trim();
      let date = document.getElementById("date").value;
      let time = document.getElementById("time").value;
      const priority = parseInt(document.getElementById("priority").value, 10);

      if (!company || !role) return alert("Company + role required.");

      if (!date || !time){
        const now = localNowISO();
        date = date || now.date;
        time = time || now.time;
      }

      // store as ISO-like local string
      const ts = new Date(`${date}T${time}:00`).getTime();

      rows.push({ id: uuid(), company, role, date, time, ts, priority });
      persist();

      document.getElementById("company").value = "";
      document.getElementById("role").value = "";
      render();
    }

    function remove(id){
      rows = rows.filter(r => r.id !== id);
      persist();
      render();
    }

    function sorted(){
      const mode = document.getElementById("sort").value;
      const arr = [...rows];

      if (mode === "time_desc") arr.sort((a,b)=> b.ts - a.ts);
      if (mode === "time_asc") arr.sort((a,b)=> a.ts - b.ts);
      if (mode === "prio_desc") arr.sort((a,b)=> (b.priority - a.priority) || (b.ts - a.ts));
      if (mode === "prio_asc") arr.sort((a,b)=> (a.priority - b.priority) || (b.ts - a.ts));

      return arr;
    }

    function render(){
      const table = document.getElementById("jobsTable");
      const data = sorted();

      table.innerHTML = `
        <thead>
          <tr>
            <th>Company</th>
            <th>Role</th>
            <th>Date</th>
            <th>Time</th>
            <th>Priority</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          ${data.map(r => `
            <tr>
              <td>${escapeHtml(r.company)}</td>
              <td>${escapeHtml(r.role)}</td>
              <td>${r.date}</td>
              <td>${r.time}</td>
              <td>${r.priority}</td>
              <td style="text-align:right;">
                <button class="xBtn" title="Delete" onclick="Jobs.remove('${r.id}')">×</button>
              </td>
            </tr>
          `).join("")}
          ${data.length === 0 ? `<tr><td colspan="6" class="muted">No job applications yet.</td></tr>` : ""}
        </tbody>
      `;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    return { add, remove, render };
  })();

  Jobs.render();
</script>
</body>
</html>
